# データベース設計書

## 1. 概要
本システムはSQLiteを使用し、TODOタスクおよびユーザー情報を保持する。  
軽量かつローカル開発に適した構成とし、FastAPI + SQLAlchemyを利用して操作を行う。

---

## 2. テーブル一覧

| テーブル名 | 説明 |
|-------------|------|
| `users` | ログインユーザー情報 |
| `tasks` | 登録されたタスク情報 |

---

## 3. テーブル定義詳細

### 3.1 `users` テーブル

| カラム名 | 型 | 主キー | 外部キー | NULL許可 | 説明 |
|-----------|----|---------|------------|-----------|------|
| id | INTEGER | PK | なし | 不可 | ユーザーID |
| username | TEXT |  | なし | 不可 | ログインユーザー名（ユニーク） |
| password_hash | TEXT |  | なし | 不可 | ハッシュ化済パスワード |
| created_at | DATETIME |  | なし | 不可 | 登録日時 |

**制約・インデックス**
- `username` にユニーク制約  
- 検索高速化のため `username` にインデックスを付与

---

### 3.2 `tasks` テーブル

| カラム名 | 型 | 主キー | 外部キー | NULL許可 | 説明 |
|-----------|----|---------|------------|-----------|------|
| id | INTEGER | PK | なし | 不可 | タスクID |
| title | TEXT |  | なし | 不可 | タスクタイトル |
| description | TEXT |  | なし | 可 | タスク詳細 |
| is_done | BOOLEAN |  | なし | 不可 | 完了フラグ |
| created_at | DATETIME |  | なし | 不可 | 登録日時 |
| user_id | INTEGER |  | FK (`users.id`) | 不可 | 所有ユーザーID |

**制約・インデックス**
- `user_id` に外部キー制約（`users.id`）
- `is_done` にインデックスを付与し、完了タスク検索を最適化

---

## 4. ER図（簡易ASCII図）

```

+-----------+           +-----------+
|  users    | 1       N |  tasks    |
+-----------+-----------+-----------+
| id (PK)   |<--------->| user_id (FK) |
| username  |           | title       |
| password  |           | is_done     |
| created_at|           | created_at  |
+-----------+           +-----------+

```

---

## 5. データ保持方針

| 項目 | 内容 |
|------|------|
| **永続化先** | SQLiteファイル（例：`app.db`） |
| **データ寿命** | 無期限（手動削除以外では消去されない） |
| **削除ポリシー** | 論理削除なし（物理削除方式） |
| **バックアップ** | 手動コピーまたはSQLiteダンプ（`sqlite3 app.db .dump > backup.sql`） |
| **復元手順** | `sqlite3 app.db < backup.sql` |

---

## 6. 運用上の制約事項
- DBスキーマ変更時はマイグレーション（`alembic`等）を使用。
- SQLiteを使用するため、同時書き込み負荷が高い環境には不向き。
- データサイズ上限は約2GBを想定。

---

## 7. 今後の拡張案
- PostgreSQL/MySQL対応による本番運用対応
- タスク履歴・操作ログテーブルの追加
- ユーザー削除時のカスケード制御
- 論理削除対応（`deleted_at` カラム追加）
