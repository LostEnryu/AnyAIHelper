# 運用・保守設計書

## 1. 概要
本ドキュメントは、FastAPI + ReactによるTODO管理アプリの運用および保守設計についてまとめたものである。  
デモ・学習用途を前提とするが、将来的な商用運用も視野に入れ、基本的な監視・バックアップ・障害対応手順を定義する。

---

## 2. デプロイ手順

### 2.1 ローカル環境
1. リポジトリを取得  
   ```bash
   git clone https://github.com/example/todo-app.git
   cd todo-app
````

2. バックエンド起動

   ```bash
   cd backend
   uvicorn main:app --reload
   ```
3. フロントエンド起動

   ```bash
   cd ../frontend
   npm install
   npm run dev
   ```
4. ブラウザでアクセス

   ```
   http://localhost:5173
   ```

### 2.2 Docker環境

```bash
docker-compose up --build
```

* バックエンド：`http://localhost:8000`
* フロントエンド：`http://localhost:5173`

---

## 3. バックアップ・リカバリ手順

### 3.1 バックアップ方針

| 対象                         | 方法           | 頻度   | 保存先             |
| -------------------------- | ------------ | ---- | --------------- |
| SQLite DB (`data/todo.db`) | ファイルコピー      | 1日1回 | `data/backup/`  |
| 設定ファイル (`.env`)            | git管理外バックアップ | 随時   | 管理者PC           |
| ログファイル (`logs/`)           | ローテーション + 圧縮 | 1日1回 | `logs/archive/` |

### 3.2 リカバリ手順

1. バックアップディレクトリから最新のDBを取得
2. `data/todo.db` を上書き復元
3. アプリケーション再起動
4. 動作確認（一覧取得・登録テスト）

---

## 4. 障害対応フロー

### 4.1 障害検知

* 手動監視（ログ／HealthCheckエンドポイント）
* 将来的にPrometheus/Grafana等の導入を想定

### 4.2 初動対応フロー

```
[ユーザー報告 or 監視検知]
        |
        v
[障害内容の確認]
        |
        +-- アプリ停止の場合 ----> 再起動（uvicorn再実行）
        |
        +-- DB破損の場合 -------> バックアップから復元
        |
        +-- API異常応答 --------> logs/error.log を調査
```

### 4.3 エスカレーション基準

| 障害レベル | 内容      | 対応時間目安 | 担当者       |
| ----- | ------- | ------ | --------- |
| L1    | 一時的なエラー | 30分以内  | 開発者       |
| L2    | API応答不可 | 1時間以内  | 管理者       |
| L3    | データ損失   | 即時対応   | 管理者＋開発責任者 |

---

## 5. 定期メンテナンス

| 項目        | 内容                   | 頻度  |
| --------- | -------------------- | --- |
| ライブラリ更新   | `pip`, `npm` パッケージ更新 | 月1回 |
| DB最適化     | 不要データ削除、Vacuum実行     | 月1回 |
| バックアップ確認  | 差分チェック、復元テスト         | 週1回 |
| ログローテーション | 古いログ圧縮削除             | 毎日  |

---

## 6. 監視項目

| 監視対象       | 内容                 | 方法                    |
| ---------- | ------------------ | --------------------- |
| API応答      | `/health` の200応答確認 | `curl`スクリプト or Ping監視 |
| DBサイズ      | SQLiteファイル容量       | cron監視                |
| アプリログ      | エラーログ行数            | grepフィルタ監視            |
| CPU/メモリ使用率 | サーバリソース            | `docker stats`        |

---

## 7. SLA / SLO

| 指標        | 目標値     | 備考               |
| --------- | ------- | ---------------- |
| 稼働率（SLA）  | 99.5%以上 | ローカル or クラウド運用前提 |
| 平均応答時間    | 1秒以内    | APIリクエストベース      |
| データ損失率    | 0%      | 毎日バックアップで保証      |
| 復旧時間（RTO） | 1時間以内   | 手動リカバリベース        |

---

## 8. 改修・リリース手順

1. GitHubでIssue作成 → 開発ブランチで修正
2. `main`ブランチへPull Request
3. コードレビュー → マージ後自動ビルド
4. Docker再ビルド & 再デプロイ
5. 動作確認 → バージョンタグ発行

---

## 9. 保守体制

| 役割   | 担当          | 主な責任             |
| ---- | ----------- | ---------------- |
| 開発者  | LostEnryu   | コード修正・機能改善       |
| 管理者  | SystemAdmin | 環境構築・監視・バックアップ管理 |
| テスター | QA担当者       | リグレッションテスト       |

---

## 10. 今後の改善項目

* 監視自動化（Prometheus + Alertmanager連携）
* GitHub Actionsによる自動バックアップチェック
* クラウド環境（AWS ECS or GCP Cloud Run）への移行
* 障害発生時のSlack通知連携
