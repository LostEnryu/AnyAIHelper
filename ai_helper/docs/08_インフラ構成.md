# インフラ構成設計書

## 1. 概要
本ドキュメントは、FastAPI + ReactによるTODO管理アプリのインフラ構成を定義する。  
本プロジェクトはデモ目的のため、ローカル環境での動作を前提とするが、将来的なクラウドデプロイを見据えた構成を併記する。

---

## 2. サーバ構成

| コンポーネント | 役割 | 技術 | 備考 |
|----------------|------|------|------|
| Webサーバ | フロントエンド提供 | React (Vite) | ポート: `5173` |
| APIサーバ | バックエンドAPI | FastAPI (Uvicorn) | ポート: `8000` |
| データベース | 永続化 | SQLite | ローカルファイル保存 |
| 静的ファイル | フロント配信 | Nginx（任意） | 開発中はVite Dev Server使用 |

---

## 3. ネットワーク構成

```

+-------------------+
|  ユーザー端末     |
| (ブラウザ, PC等)  |
+---------+---------+
|
v
+-------------------+
|  フロントエンド   |  React/Vite
|  [http://localhost:5173](http://localhost:5173) |
+---------+---------+
|
v
+-------------------+
|  APIサーバ(FastAPI)  |
|  [http://localhost:8000](http://localhost:8000) |
+---------+---------+
|
v
+-------------------+
|   SQLite DB       |
|   ./data/todo.db  |
+-------------------+

````

---

## 4. デプロイ環境

| 環境 | 概要 | デプロイ手法 |
|------|------|---------------|
| ローカル | 開発・動作確認用 | FastAPI + Vite直接起動 |
| ステージング | 検証用 | Docker Compose想定 |
| 本番 | 任意（AWS or GCP） | CI/CDを用いた自動デプロイ（例：GitHub Actions） |

### 4.1 Docker構成（想定例）

```yaml
version: "3"
services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
  frontend:
    build: ./frontend
    ports:
      - "5173:5173"
  db:
    image: sqlite
    volumes:
      - ./data:/data
````

---

## 5. 冗長化・スケーリング方針

* 現段階では冗長化なし（単一ノード構成）
* 将来的な対応案：

  * APIサーバを複数Podにスケール（Kubernetes運用時）
  * SQLite→PostgreSQLへの移行
  * Cloud Storage利用による永続化

---

## 6. ログ設計

| ログ種別   | 出力先              | 内容             | ローテーション    |
| ------ | ---------------- | -------------- | ---------- |
| アプリログ  | `logs/app.log`   | APIリクエスト・レスポンス | 1日単位でローテート |
| アクセスログ | コンソール            | 開発デバッグ用        | 任意         |
| エラーログ  | `logs/error.log` | 例外発生時の詳細       | 障害分析用      |

---

## 7. 監視・アラート設計

| 項目       | 方法                      | 備考           |
| -------- | ----------------------- | ------------ |
| アプリ稼働確認  | HealthCheck `/health`   | 200応答を監視     |
| サーバリソース  | `htop` / `docker stats` | ローカル環境での簡易監視 |
| ログ監視     | tail + grep             | 開発用簡易ツールで代替  |
| 将来的監視ツール | Prometheus + Grafana    | Docker導入後を想定 |

---

## 8. セキュリティ対策

* ローカル通信限定（`localhost` バインド）
* 不要ポート閉鎖（8000, 5173以外）
* Docker利用時は`.env`で秘密情報を管理
* OS更新・依存ライブラリアップデートを定期的に実施

---

## 9. バックアップ戦略

* SQLite DBファイルを毎日自動バックアップ（`data/backup/`）
* gitignore設定でコミット対象外に設定
* 将来的にS3互換ストレージへの定期同期を検討

---

## 10. 今後の拡張計画

* Docker Compose → Kubernetes移行
* Nginxリバースプロキシ導入
* CI/CDによる自動デプロイ（GitHub Actions + DockerHub）
