# 認証・認可設計

## 1. 概要
本システムは、ローカル環境で動作するデモ用TODO管理アプリであり、**シンプルなユーザー認証機構**を採用する。  
本番運用を想定しないため、外部認証サービス（OAuth等）は使用せず、**ローカルDBベースの簡易ログイン認証**を行う。

---

## 2. ユーザー認証方式

| 項目 | 内容 |
|------|------|
| **認証方式** | セッションベース or JWT（トークン認証） |
| **採用理由** | 軽量でFastAPIとの親和性が高く、フロントエンド（React）からのAPIアクセスにも適する |
| **パスワード保護** | PBKDF2 + SHA256 によるハッシュ化（`passlib`使用） |
| **通信保護** | HTTPSを前提としないローカル環境のため、開発中はHTTPで許容 |

実装例（JWT）：
- `/auth/login` にてユーザー認証を実施
- 成功時に署名付きJWTトークンを発行
- フロントエンドがローカルストレージに保持
- 各APIリクエスト時に `Authorization: Bearer <token>` を付与

---

## 3. 権限管理（Authorization）

| 役割 | 権限 | 備考 |
|------|------|------|
| 一般ユーザー | 自分のタスクの閲覧・登録・更新・削除 | デフォルト権限 |
| 管理者（オプション） | すべてのタスク操作 | 将来的な拡張を想定 |

- 現行フェーズでは「ユーザー単位」のスコープで管理。
- ロールベース制御（RBAC）は必要に応じて導入可能。

---

## 4. アクセス制御フロー

```

[Reactフロントエンド]
│
│ ログイン情報送信（/auth/login）
▼
[FastAPI 認証エンドポイント]
│
│ ユーザー認証 → JWTトークン発行
▼
[Reactクライアント] -- Authorizationヘッダ付与 -->
▼
[FastAPI 各APIエンドポイント]
│
│ トークン検証（有効期限・署名）
▼
[DBアクセス or エラーレスポンス]

```

---

## 5. セキュリティ要件

| 要件 | 内容 |
|------|------|
| **パスワード規則** | 8文字以上、英大小文字・数字を含む |
| **多要素認証** | 不要（ローカルデモ目的） |
| **トークン有効期限** | 24時間（再ログインで更新） |
| **トークン保管場所** | クライアント側LocalStorage（またはHttpOnly Cookie） |
| **エラーレスポンス** | 認証失敗時はHTTP 401 Unauthorized |
| **ログ出力** | 認証失敗時の試行回数を制限（ブルートフォース対策） |

---

## 6. 想定される攻撃と対策

| 攻撃手法 | リスク | 対策 |
|------------|--------|------|
| **総当たり攻撃（Brute Force）** | パスワード推測 | ログイン試行制限（例：5回でロック） |
| **トークン盗難** | 不正アクセス | 有効期限短縮、署名キー管理 |
| **XSS攻撃** | トークン流出 | React自動エスケープ、HttpOnly Cookie利用 |
| **CSRF** | 不正リクエスト | JWT利用により防止、トークン検証実施 |
| **SQL Injection** | DB改ざん | ORM（SQLAlchemy）使用で防止 |

---

## 7. 前提・制約事項
- ローカル環境のみで稼働。
- 本番運用を想定したID管理システム（OAuth2, SSO等）は除外。
- セキュリティ要件は開発・デモ目的の最小限とする。

---

## 8. 今後の拡張案
- OAuth2（Google / GitHub）による外部ログイン対応
- 管理者用ロールの追加
- HTTPS通信対応およびCookieベースセキュリティ強化
