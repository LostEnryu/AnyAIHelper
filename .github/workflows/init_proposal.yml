name: Init Issue → AI Prompt Generation

on:
  issues:
    types: [opened]

jobs:
  generate_proposals:
    if: ${{ github.event.issue.title == '[Init] ' }}
    runs-on: ubuntu-latest

    steps:
      # 1. リポジトリをチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Pythonセットアップ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. Python依存関係インストール
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f ai_helper/requirements.txt ]; then pip install -r ai_helper/requirements.txt; fi

      # 4. Pythonスクリプトでフォルダ作成・プロンプト生成・コミットまで実行
      - name: Run init prompt generator
        run: |
          python ai_helper/scripts/init_prompt_generator.py \
            --issue-number ${{ github.event.issue.number }} \
            --actor "${{ github.actor }}" \
            --repo "${{ github.repository }}"